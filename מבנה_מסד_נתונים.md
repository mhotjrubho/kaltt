# מבנה מסד הנתונים של KalttOffline

## טבלאות מסד הנתונים

### 1. years (שנים)
- **id** - מזהה ייחודי (מספר)
- **label** - שם השנה (טקסט)
- **is_current** - האם השנה הנוכחית (0/1)

### 2. groups (קבוצות)
- **id** - מזהה ייחודי (טקסט)
- **name** - שם קבוצה (טקסט)
- **logo_path** - נתיב ללוגו (טקסט, null אפשרי)
- **year_id** - מזהה שנה (מספר)

### 3. persons (בחורים)
- **id** - מספר תעודת זהות (טקסט, מפתח ראשי)
- **full_name** - שם מלא (טקסט)
- **group_id** - מזהה קבוצה (טקסט, null אפשרי)
- **is_premium** - האם פרימיום (0/1)

### 4. commitments (התחייבויות)
- **id** - מזהה ייחודי (מספר)
- **person_id** - מספר תעודת זהות (טקסט)
- **group_id** - מזהה קבוצה (טקסט)
- **target** - יעד אישי (מספר)
- **is_premium** - האם פרימיום (0/1)
- **created_at** - תאריך יצירה (ISO timestamp)
- **year_id** - מזהה שנה (מספר)

### 5. collection_days (ימי איסוף)
- **id** - מזהה ייחודי (מספר)
- **name** - שם יום איסוף (טקסט)
- **year_id** - מזהה שנה (מספר)

### 6. collections (איסופים)
- **person_id** - מספר תעודת זהות (טקסט)
- **day_id** - מזהה יום איסוף (מספר)
- **amount** - סכום שנאסף (מספר)

### 7. announcements (הודעות)
- **id** - מזהה ייחודי (מספר)
- **type** - סוג הודעה (ticker/banner/push)
- **title** - כותרת (טקסט)
- **text** - טקסט (טקסט)
- **signature** - חתימה (טקסט)
- **expires_at** - תפוגה (ISO timestamp, null אפשרי)
- **payload** - נתונים נוספים (JSON)
- **created_at** - תאריך יצירה (ISO timestamp)
- **year_id** - מזהה שנה (מספר)

### 8. donors (תורמים)
- **id** - מזהה ייחודי (מספר)
- **full_name** - שם מלא (טקסט)
- **phone** - טלפון (טקסט)
- **is_graduate** - האם בוגר (0/1)
- **parent_person_id** - מקושר לבחור (ת.ז, null אפשרי)
- **rating** - דירוג (potential/regular/frequent/major)
- **notes** - הערות (טקסט)
- **created_at** - תאריך יצירה (ISO timestamp)
- **updated_at** - תאריך עדכון (ISO timestamp, null אפשרי)

### 9. donations (תרומות)
- **id** - מזהה ייחודי (מספר)
- **donor_id** - מזהה תורם (מספר)
- **amount** - סכום תרומה (מספר)
- **collection_day_id** - מזהה יום איסוף (מספר)
- **notes** - הערות (טקסט)
- **created_at** - תאריך יצירה (ISO timestamp)
- **updated_at** - תאריך עדכון (ISO timestamp, null אפשרי)
- **year_id** - מזהה שנה (מספר)

### 10. lotteries (הגרלות)
- **id** - מזהה ייחודי (מספר)
- **name** - שם הגרלה (טקסט)
- **description** - תיאור (טקסט)
- **prize** - פרס (טקסט)
- **created_at** - תאריך יצירה (ISO timestamp)
- **is_active** - האם פעילה (0/1)
- **winner_person_id** - מזהה זוכה (ת.ז, null אפשרי)
- **winner_person_name** - שם זוכה (טקסט, null אפשרי)
- **winner_ticket_number** - מספר כרטיס זוכה (מספר, null אפשרי)
- **drawn_at** - תאריך הגרלה (ISO timestamp, null אפשרי)
- **year_id** - מזהה שנה (מספר)

### 11. users (משתמשים)
- **id** - מזהה ייחודי (מספר)
- **username** - שם משתמש (טקסט, ייחודי)
- **password** - סיסמה (טקסט)
- **full_name** - שם מלא (טקסט)
- **yeshiva_name** - שם ישיבה (טקסט)
- **is_admin** - האם מנהל (0/1)
- **created_at** - תאריך יצירה (ISO timestamp)

### 12. settings (הגדרות)
- **theme** - ערכת עיצוב (טקסט)
- **primary_color** - צבע ראשי (hex)
- **secondary_color** - צבע משני (hex)
- **background_color** - צבע רקע (hex)
- **yeshiva_name** - שם ישיבה (טקסט)
- **current_year_id** - מזהה שנה נוכחית (מספר)
- **auto_save_interval** - רווח שמירה אוטומטית (שניות)
- **show_hebrew_dates** - הצגת תאריכים עבריים (true/false)
- **rtl_enabled** - הפעלת RTL (true/false)
- **updated_at** - תאריך עדכון (ISO timestamp, null אפשרי)

### 13. logs (לוגים)
- **id** - מזהה ייחודי (מספר)
- **level** - רמת לוג (info/warning/error/debug)
- **message** - הודעה (טקסט)
- **data** - נתונים נלווים (JSON, null אפשרי)
- **timestamp** - חותמת זמן (ISO timestamp)

## קשרים בין טבלאות

- **persons** → **groups** (group_id)
- **persons** → **years** (דרך groups)
- **commitments** → **persons** (person_id)
- **commitments** → **groups** (group_id)
- **commitments** → **years** (year_id)
- **collections** → **persons** (person_id)
- **collections** → **collection_days** (day_id)
- **donors** → **persons** (parent_person_id)
- **donations** → **donors** (donor_id)
- **donations** → **collection_days** (collection_day_id)
- **donations** → **years** (year_id)
- **lotteries** → **years** (year_id)
- **announcements** → **years** (year_id)
- **collection_days** → **years** (year_id)
- **groups** → **years** (year_id)

## חוקי הגרלות

- כל בחור עם התחייבות של 1000 ש"ח ומעלה מקבל כרטיס אחד לכל 1000 ש"ח
- כרטיסים נצברים אוטומטית על סמך היעדים
- הגרלה מתבצעת רק על ידי מנהל
- זוכה נשמר בטבלת ההגרלה

## ייצוא וגיבוי

- כל הנתונים מיוצאים לפי שנים
- ייצוא תומך ב-JSON ו-PDF
- גיבוי מלא כולל את כל מסד הנתונים
- תיקיות: data (מסד נתונים), logs (לוגים), assets (לוגואים ותמונות), config (הגדרות)

## אבטחה

- משתמשים עם הרשאות מנהל/רגיל
- נתונים נשמרים מקומית בלבד
- אין תלות באינטרנט לפעולה סדירה
